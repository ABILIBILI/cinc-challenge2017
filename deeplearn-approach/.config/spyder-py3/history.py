# -*- coding: utf-8 -*-
# *** Spyder Python Console History Log ***

##---(Wed Sep 27 09:52:26 2017)---
from keras.models import load_model
model = load_model('ResNet_30s_34lay_16conv.hdf5')
model.summary()
print('https://www.physionet.org/physiobank/database/challenge/2017/training/A00/A{:5.0d}.hea'.format(randint(0, 999)))
from subprocess import call
from random import randint

call(["ls", "-l"])
print('https://www.physionet.org/physiobank/database/challenge/2017/training/A00/A{:5.0d}.hea'.format(randint(0, 999)))
print('https://www.physionet.org/physiobank/database/challenge/2017/training/A00/A{}.hea'.format(randint(0, 999)))
print('https://www.physionet.org/physiobank/database/challenge/2017/training/A00/A%02d.hea'.format(randint(0, 999)))
print('https://www.physionet.org/physiobank/database/challenge/2017/training/A00/A{02d}.hea'.format(randint(0, 999)))
print('https://www.physionet.org/physiobank/database/challenge/2017/training/A00/A{:02d}.hea'.format(randint(0, 999)))
print('https://www.physionet.org/physiobank/database/challenge/2017/training/A00/A{num:05d}.hea'.format(randint(0, 999)))
print('https://www.physionet.org/physiobank/database/challenge/2017/training/A00/A{:05d}.hea'.format(randint(0, 999)))
call(['https://www.physionet.org/physiobank/database/challenge/2017/training/A00/A{:05d}.hea'.format(randint(0, 999))])
call([wget -r -np 'https://www.physionet.org/physiobank/database/challenge/2017/training/A00/A{:05d}.mat'.format(randint(0, 999))])
call(['wget -r -np https://www.physionet.org/physiobank/database/challenge/2017/training/A00/A{:05d}.mat'.format(randint(0, 999))])
call(['wget -np https://www.physionet.org/physiobank/database/challenge/2017/training/A00/A{:05d}.mat'.format(randint(0, 999))])
call(['wget https://www.physionet.org/physiobank/database/challenge/2017/training/A00/A{:05d}.mat'.format(randint(0, 999))])
os.system(['wget https://www.physionet.org/physiobank/database/challenge/2017/training/A00/A{:05d}.mat'.format(randint(0, 999))])
import os
os.system(['wget https://www.physionet.org/physiobank/database/challenge/2017/training/A00/A{:05d}.mat'.format(randint(0, 999))])
os.system(['wget -np https://www.physionet.org/physiobank/database/challenge/2017/training/A00/A{:05d}.mat'.format(randint(0, 999))])
import urllib

urllib.urlretrieve ("https://www.physionet.org/physiobank/database/challenge/2017/training/A00/A{:05d}.mat'.format(randint(0, 999))
, "record.mat")
urllib.urlretrieve ("https://www.physionet.org/physiobank/database/challenge/2017/training/A00/A{:05d}.mat'.format(randint(0, 999))", "record.mat")
import urllib
urllib.urlretrieve ("https://www.physionet.org/physiobank/database/challenge/2017/training/A00/A{:05d}.mat'.format(randint(0, 999))", "record.mat")
urlretrieve ("https://www.physionet.org/physiobank/database/challenge/2017/training/A00/A{:05d}.mat'.format(randint(0, 999))", "record.mat")
import urllib2
urllib2.urlopen("https://www.physionet.org/physiobank/database/challenge/2017/training/A00/A{:05d}.mat'.format(randint(0, 999))", "record.mat")

##---(Wed Sep 27 10:17:55 2017)---
import urllib.request
with urllib.request.urlopen("https://www.physionet.org/physiobank/database/challenge/2017/training/A00/A{:05d}.mat".format(randint(0, 999)) as response:
   html = response.read()
with urllib.request.urlopen("https://www.physionet.org/physiobank/database/challenge/2017/training/A00/A{:05d}.mat".format(randint(0, 999))) as response:
   html = response.read()
import urllib.request
with urllib.request.urlopen("https://www.physionet.org/physiobank/database/challenge/2017/training/A00/A{:05d}.mat".format(randint(0, 999))) as response:
   html = response.read()
from random import randint
with urllib.request.urlopen("https://www.physionet.org/physiobank/database/challenge/2017/training/A00/A{:05d}.mat".format(randint(0, 999))) as response:
   html = response.read()
urlfile = "https://www.physionet.org/physiobank/database/challenge/2017/training/A00/A{:05d}.mat".format(randint(0, 999))
local_filename, headers = urllib.request.urlretrieve(urlfile)
html = open(local_filename)
html
import sys
import scipy.io
record = sys.argv[1]
mat_data = scipy.io.loadmat(local_filename + ".mat")
data = mat_data['val']
mat_data = scipy.io.loadmat(local_filename)
data = mat_data['val']
dat
data
plt.plot(data)
import matplotlib.pyplot as plt
plt.plot(data)
plt.plot(data.T)
runfile('/sharedfolder/predict.py', wdir='/sharedfolder')
import sys
import scipy.io
record = sys.argv[1]

# Download some random waveform from challenge database
from random import randint
import urllib.request
urlfile = "https://www.physionet.org/physiobank/database/challenge/2017/training/A00/A{:05d}.mat".format(randint(0, 999))
local_filename, headers = urllib.request.urlretrieve(urlfile)
html = open(local_filename)

# Load data
mat_data = scipy.io.loadmat(local_filename)
data = mat_data['val']

# Parameters
FS = 300
maxlen = 30*FS
classes = ['A', 'N', 'O','~']
import sys
import scipy.io
record = sys.argv[1]
runfile('/sharedfolder/predict.py', wdir='/sharedfolder')
from random import randint
import urllib.request
record = "A{:05d}".format(randint(0, 999))
urlfile = "https://www.physionet.org/physiobank/database/challenge/2017/training/A00/{}.mat".format(record)
from random import randint
import urllib.request
record = "A{:05d}".format(randint(0, 999))
urlfile = "https://www.physionet.org/physiobank/database/challenge/2017/training/A00/{}.mat".format(record)
local_filename, headers = urllib.request.urlretrieve(urlfile)
html = open(local_filename)
print('Downloading {} record ..'.format(record))
import scipy.io
mat_data = scipy.io.loadmat(local_filename)
data = mat_data['val']
FS = 300
maxlen = 30*FS
classes = ['A', 'N', 'O','~']

# Preprocessing data
print("Preprocessing recording ..")    
import numpy as np
X = np.zeros((1,maxlen))
data = np.nan_to_num(data) # removing NaNs and Infs
data = data[0,0:maxlen]
data = data - np.mean(data)
data = data/np.std(data)
X[0,:len(data)] = data.T # padding sequence
data = X
data = np.expand_dims(data, axis=2) # required by Keras
del X
data
plt.plot(data)
plt.plot(data[0,:,0])
print("Loading model")    
from keras.models import load_model
model = load_model('ResNet_30s_34lay_16conv.hdf5')
print("Applying model ..")    
prob = model.predict(data)
ann = np.argmax(prob)
print("Record {} classified as {} with {:3.1f}% certainty".format(record,classes[ann],100*prob[0,ann]))
reset
runfile('/sharedfolder/predict.py', wdir='/sharedfolder')
del model
runfile('/sharedfolder/predict.py', wdir='/sharedfolder')
reset
runfile('/sharedfolder/predict.py', wdir='/sharedfolder')
reset
runfile('/sharedfolder/predict.py', wdir='/sharedfolder')
from random import randint
import urllib.request
record = "A{:05d}".format(randint(0, 999))
urlfile = "https://www.physionet.org/physiobank/database/challenge/2017/training/A00/{}.mat".format(record)
local_filename, headers = urllib.request.urlretrieve(urlfile)
html = open(local_filename)
print('Downloading record {} ..'.format(record))

# Load data
import scipy.io
mat_data = scipy.io.loadmat(local_filename)
data = mat_data['val']

# Parameters
FS = 300
maxlen = 30*FS
classes = ['A', 'N', 'O','~']

# Preprocessing data
print("Preprocessing recording ..")    
import numpy as np
X = np.zeros((1,maxlen))
data = np.nan_to_num(data) # removing NaNs and Infs
data = data[0,0:maxlen]
data = data - np.mean(data)
data = data/np.std(data)
X[0,:len(data)] = data.T # padding sequence
data = X
data = np.expand_dims(data, axis=2) # required by Keras
del X
print("Applying model ..")    
prob = model.predict(data)
ann = np.argmax(prob)
print("Record {} classified as {} with {:3.1f}% certainty".format(record,classes[ann],100*prob[0,ann]))
from random import randint
import urllib.request
record = "A{:05d}".format(randint(0, 999))
urlfile = "https://www.physionet.org/physiobank/database/challenge/2017/training/A00/{}.mat".format(record)
local_filename, headers = urllib.request.urlretrieve(urlfile)
html = open(local_filename)
print('Downloading record {} ..'.format(record))

# Load data
import scipy.io
mat_data = scipy.io.loadmat(local_filename)
data = mat_data['val']

# Parameters
FS = 300
maxlen = 30*FS
classes = ['A', 'N', 'O','~']

# Preprocessing data
print("Preprocessing recording ..")    
import numpy as np
X = np.zeros((1,maxlen))
data = np.nan_to_num(data) # removing NaNs and Infs
data = data[0,0:maxlen]
data = data - np.mean(data)
data = data/np.std(data)
X[0,:len(data)] = data.T # padding sequence
data = X
data = np.expand_dims(data, axis=2) # required by Keras
del X
print("Applying model ..")    
prob = model.predict(data)
ann = np.argmax(prob)
print("Record {} classified as {} with {:3.1f}% certainty".format(record,classes[ann],100*prob[0,ann]))
from random import randint
import urllib.request
record = "A{:05d}".format(randint(0, 999))
urlfile = "https://www.physionet.org/physiobank/database/challenge/2017/training/A00/{}.mat".format(record)
local_filename, headers = urllib.request.urlretrieve(urlfile)
html = open(local_filename)
print('Downloading record {} ..'.format(record))

# Load data
import scipy.io
mat_data = scipy.io.loadmat(local_filename)
data = mat_data['val']

# Parameters
FS = 300
maxlen = 30*FS
classes = ['A', 'N', 'O','~']

# Preprocessing data
print("Preprocessing recording ..")    
import numpy as np
X = np.zeros((1,maxlen))
data = np.nan_to_num(data) # removing NaNs and Infs
data = data[0,0:maxlen]
data = data - np.mean(data)
data = data/np.std(data)
X[0,:len(data)] = data.T # padding sequence
data = X
data = np.expand_dims(data, axis=2) # required by Keras
del X
print("Applying model ..")    
prob = model.predict(data)
ann = np.argmax(prob)
print("Record {} classified as {} with {:3.1f}% certainty".format(record,classes[ann],100*prob[0,ann]))
prob
from random import randint
import urllib.request
record = "A{:05d}".format(randint(0, 999))
urlfile = "https://www.physionet.org/physiobank/database/challenge/2017/training/A00/{}.mat".format(record)
local_filename, headers = urllib.request.urlretrieve(urlfile)
html = open(local_filename)
print('Downloading record {} ..'.format(record))

# Load data
import scipy.io
mat_data = scipy.io.loadmat(local_filename)
data = mat_data['val']

# Parameters
FS = 300
maxlen = 30*FS
classes = ['A', 'N', 'O','~']

# Preprocessing data
print("Preprocessing recording ..")    
import numpy as np
X = np.zeros((1,maxlen))
data = np.nan_to_num(data) # removing NaNs and Infs
data = data[0,0:maxlen]
data = data - np.mean(data)
data = data/np.std(data)
X[0,:len(data)] = data.T # padding sequence
data = X
data = np.expand_dims(data, axis=2) # required by Keras
del X
print("Applying model ..")    
prob = model.predict(data)
ann = np.argmax(prob)
print("Record {} classified as {} with {:3.1f}% certainty".format(record,classes[ann],100*prob[0,ann]))
from random import randint
import urllib.request
record = "A{:05d}".format(randint(0, 999))
urlfile = "https://www.physionet.org/physiobank/database/challenge/2017/training/A00/{}.mat".format(record)
local_filename, headers = urllib.request.urlretrieve(urlfile)
html = open(local_filename)
print('Downloading record {} ..'.format(record))

# Load data
import scipy.io
mat_data = scipy.io.loadmat(local_filename)
data = mat_data['val']

# Parameters
FS = 300
maxlen = 30*FS
classes = ['A', 'N', 'O','~']

# Preprocessing data
print("Preprocessing recording ..")    
import numpy as np
X = np.zeros((1,maxlen))
data = np.nan_to_num(data) # removing NaNs and Infs
data = data[0,0:maxlen]
data = data - np.mean(data)
data = data/np.std(data)
X[0,:len(data)] = data.T # padding sequence
data = X
data = np.expand_dims(data, axis=2) # required by Keras
del X
print("Applying model ..")    
prob = model.predict(data)
ann = np.argmax(prob)
print("Record {} classified as {} with {:3.1f}% certainty".format(record,classes[ann],100*prob[0,ann]))
from random import randint
import urllib.request
record = "A{:05d}".format(randint(0, 999))
urlfile = "https://www.physionet.org/physiobank/database/challenge/2017/training/A00/{}.mat".format(record)
local_filename, headers = urllib.request.urlretrieve(urlfile)
html = open(local_filename)
print('Downloading record {} ..'.format(record))

# Load data
import scipy.io
mat_data = scipy.io.loadmat(local_filename)
data = mat_data['val']

# Parameters
FS = 300
maxlen = 30*FS
classes = ['A', 'N', 'O','~']

# Preprocessing data
print("Preprocessing recording ..")    
import numpy as np
X = np.zeros((1,maxlen))
data = np.nan_to_num(data) # removing NaNs and Infs
data = data[0,0:maxlen]
data = data - np.mean(data)
data = data/np.std(data)
X[0,:len(data)] = data.T # padding sequence
data = X
data = np.expand_dims(data, axis=2) # required by Keras
del X
print("Applying model ..")    
prob = model.predict(data)
ann = np.argmax(prob)
print("Record {} classified as {} with {:3.1f}% certainty".format(record,classes[ann],100*prob[0,ann]))